<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE book [
<!ENTITY % sgml.features "IGNORE">
<!ENTITY % xml.features "INCLUDE">
<!ENTITY % DOCBOOK_ENTS PUBLIC "-//OASIS//ENTITIES DocBook Character Entities V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/dbcentx.mod">
%DOCBOOK_ENTS;
]>
<?asciidoc-toc maxdepth="3"?>
<?asciidoc-numbered?>
<book xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0">
<info>
<title>Forklift</title>
<date>2020-11-29</date>
</info>
<preface>
<title>Preface</title>
<important>
<title>Draft documentation</title>
<simpara>This draft document is a work in progress.</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>It might not be complete.</simpara>
</listitem>
<listitem>
<simpara>It might be not accurate.</simpara>
</listitem>
<listitem>
<simpara>It might break your environment.</simpara>
</listitem>
</orderedlist>
</important>
<simpara>Forklift enables you to migrate a large number of virtual machines from VMware vSphere to KubeVirt.</simpara>
<simpara>You can download the VMware provider data collected by Forklift and upload it to the Migration Analytics service on <link xlink:href="https://cloud.redhat.com/migrations/migration-analytics">cloud.redhat.com</link> for a detailed workload analysis report and migration recommendations.</simpara>
</preface>
<chapter xml:id="about-mtv_mtv">
<title>About Forklift</title>
<simpara>IN PROGRESS</simpara>
<simpara>Placeholder for diagram</simpara>
<formalpara>
<title>Custom resources</title>
<para>Forklift creates the following custom resources (CRs):</para>
</formalpara>
<itemizedlist>
<listitem>
<simpara><literal>Provider</literal>:</simpara>
<itemizedlist>
<listitem>
<simpara>Created when you add a source or target provider</simpara>
</listitem>
<listitem>
<simpara>Stores provider attributes in order to connect to and interact with the providers</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara><literal>Plan</literal>:</simpara>
<itemizedlist>
<listitem>
<simpara>Created when you create a migration plan</simpara>
</listitem>
<listitem>
<simpara>Contains a list of VMs that are migrated together with the same migration parameters</simpara>
</listitem>
<listitem>
<simpara>Selects VMs to fit the available migration resources until all VMs are migrated</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara><literal>Mapping</literal>: Created when you map source and target networks or source and target storage</simpara>
</listitem>
<listitem>
<simpara><literal>Migration</literal>:</simpara>
<itemizedlist>
<listitem>
<simpara>Created when you run a migration plan</simpara>
</listitem>
<listitem>
<simpara>Aggregates the migration progress</simpara>
<simpara>If a virtual machine fails to migrate, you can run a new migration with the same migration plan. Only the virtual machines that have not migrated will be migrated.</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<formalpara>
<title>Services</title>
<para>Forklift creates the following services:</para>
</formalpara>
<itemizedlist>
<listitem>
<simpara>Provider Inventory:</simpara>
<itemizedlist>
<listitem>
<simpara>Connects to the source and target providers</simpara>
</listitem>
<listitem>
<simpara>Maintains a local inventory for mappings and plans</simpara>
</listitem>
<listitem>
<simpara>Separate provider inventory pods for each provider enable scalability</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Validation:</simpara>
<itemizedlist>
<listitem>
<simpara>Validates the suitability of a VM for migration to KubeVirt by applying rules</simpara>
</listitem>
<listitem>
<simpara>Triggered by the Provider Inventory service whenever a VM configuration change is detected</simpara>
</listitem>
<listitem>
<simpara>Stores the VM validation status</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>User Interface:</simpara>
<itemizedlist>
<listitem>
<simpara>Enables you to manipulate the Forklift CRs</simpara>
</listitem>
<listitem>
<simpara>Indicates the state of the CRs</simpara>
</listitem>
<listitem>
<simpara>Displays the progress of a migration</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Controller: Implements the logic to reconcile the CRs with the state defined by the user</simpara>
<simpara>For example, when you create a Plan, the controllers validate it and add a status label. If a Plan fails validation, its status is <literal>Not ready</literal> and the Plan cannot be used to perform a migration.</simpara>
</listitem>
<listitem>
<simpara>Aggregates the status of related CRs to provide a holistic and consistent view of the state of a migration</simpara>
</listitem>
</itemizedlist>
</chapter>
<chapter xml:id="planning-migration_mtv">
<title>Planning the migration - tbd</title>
<simpara>TBD</simpara>
</chapter>
<chapter xml:id="installing-mtv_mtv">
<title>Installing Forklift</title>
<simpara>You can install the Forklift with the KubeVirt web console or from the CLI.</simpara>
<simpara>Then you can create a VMware Virtual Disk Development Kit (VDDK) image. Forklift uses VDDK to copy the source disks.</simpara>
<section xml:id="installing-mtv-console_installing-mtv">
<title>Installing Forklift with the web console</title>
<simpara>You can install the Forklift with the KubeVirt web console.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>Admin privileges</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the KubeVirt web console, click <emphasis role="strong">Operators</emphasis> &#8594; <emphasis role="strong">OperatorHub</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the Operator and then click <emphasis role="strong">Install</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>On the <emphasis role="strong">Install Operator</emphasis> page, click <emphasis role="strong">Install</emphasis>.</simpara>
<simpara>On the <emphasis role="strong">Installed Operators</emphasis> page, the <emphasis role="strong">Forklift Operator</emphasis> appears in the <emphasis role="strong">openshift-migration</emphasis> project with the status <emphasis role="strong">Succeeded</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Forklift Operator</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Under <emphasis role="strong">Provided APIs</emphasis>, locate the <emphasis role="strong">VirtController</emphasis> tile, and click <emphasis role="strong">Create Instance</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Create</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Workloads</emphasis> &#8594; <emphasis role="strong">Pods</emphasis> to verify that the Provider Inventory, Validation, User Interface, and Controller pods are running.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="installing-mtv-cli_installing-mtv">
<title>Installing Forklift from the CLI</title>
<simpara>You can install the Forklift from the CLI.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara><link xlink:href="https://docs.openshift.com/container-platform/4.6/cli_reference/openshift_cli/getting-started-cli.html">OpenShift CLI</link> installed</simpara>
</listitem>
<listitem>
<simpara>Admin privileges</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Log in to the OpenShift&#160;Kubernetes&#160;Engine cluster and create an <literal>openshift-migration</literal> project:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ cat &lt;&lt; EOF | oc apply -f -
---
apiVersion: project.openshift.io/v1
kind: Project
metadata:
  name: openshift-migration
EOF</programlisting>
</listitem>
<listitem>
<simpara>Create an <literal>OperatorGroup</literal> object called <literal>migration</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ cat &lt;&lt; EOF | oc apply -f -
---
apiVersion: operators.coreos.com/v1
kind: OperatorGroup
metadata:
  name: migration
  namespace: openshift-migration
spec:
  targetNamespaces:
    - openshift-migration
EOF</programlisting>
</listitem>
<listitem>
<simpara>Create a <literal>Subscription</literal> object for the <literal>virt-operator</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ cat &lt;&lt; EOF | oc apply -f -
---
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: virt-operator
  namespace: openshift-migration
spec:
  channel: development
  installPlanApproval: Automatic
  name: virt-operator
  source: konveyor-for-vms
  sourceNamespace: openshift-marketplace
  startingCSV: "konveyor-virt-operator.v99.0.0"
EOF</programlisting>
</listitem>
<listitem>
<simpara>Create a <literal>VirtController</literal> object:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ cat &lt;&lt; EOF | oc apply -f -
---
apiVersion: virt.konveyor.io/v1alpha1
kind: VirtController
metadata:
  name: virt-controller
  namespace: openshift-migration
spec:
  olm_managed: true
EOF</programlisting>
</listitem>
<listitem>
<simpara>View the resources created by the <literal>VirtController</literal> object:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get pods -n openshift-migration</programlisting>
<formalpara>
<title>Example output</title>
<para>
<screen>TBD</screen>
</para>
</formalpara>
</listitem>
</orderedlist>
</section>
<section xml:id="adding-vddk-to-mtv_installing-mtv">
<title>Adding a VDDK image to Forklift</title>
<simpara>You can create a VDDK image and store it in a private image registry. Then, you can add the image to the <literal>v2v-vmware</literal> ConfigMap.</simpara>
<note>
<simpara>Storing the VDDK image in a public registry might violate the terms of the VMware license.</simpara>
</note>
<bridgehead xml:id="_prerequisites" renderas="sect3">Prerequisites</bridgehead>
<itemizedlist>
<listitem>
<simpara>An internal <link xlink:href="https://docs.openshift.com/container-platform/4.6/registry/configuring_registry_storage/configuring-registry-storage-baremetal.html">OpenShift&#160;Kubernetes&#160;Engine image registry</link> or a secure <link xlink:href="https://docs.openshift.com/container-platform/4.6/registry/registry-options.html">external registry</link></simpara>
</listitem>
<listitem>
<simpara>Access to the image registry from your KubeVirt environment</simpara>
</listitem>
<listitem>
<simpara>Podman installed</simpara>
</listitem>
</itemizedlist>
<bridgehead xml:id="_procedure" renderas="sect3">Procedure</bridgehead>
<orderedlist numeration="arabic">
<listitem>
<simpara>Create and navigate to a temporary directory:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ mkdir /tmp/&lt;dir_name&gt; &amp;&amp; cd /tmp/&lt;dir_name&gt;</programlisting>
</listitem>
<listitem>
<simpara>In a browser, navigate to <link xlink:href="https://code.vmware.com/home">VMware code</link> and click <emphasis role="strong">SDKs</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Compute Virtualization</emphasis> section, click <emphasis role="strong">Virtual Disk Development Kit (VDDK)</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the VDDK version that corresponds to your VMware vSphere version, for example, VDDK 7.0 for vSphere 7.0.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Download</emphasis> and save the VDDK archive in the temporary directory.</simpara>
</listitem>
<listitem>
<simpara>Extract the VDDK archive:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ tar -xzf VMware-vix-disklib-&lt;version&gt;.x86_64.tar.gz</programlisting>
</listitem>
<listitem>
<simpara>Create a <literal>Dockerfile</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ cat &gt; Dockerfile &lt;&lt;EOF
FROM busybox:latest
COPY vmware-vix-disklib-distrib /vmware-vix-disklib-distrib
RUN mkdir -p /opt
ENTRYPOINT ["cp", "-r", "/vmware-vix-disklib-distrib", "/opt"]
EOF</programlisting>
</listitem>
<listitem>
<simpara>Build the image:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ podman build . -t &lt;registry_route_or_server_path&gt;/vddk:&lt;tag&gt; <co xml:id="CO1-1"/></programlisting>
<calloutlist>
<callout arearefs="CO1-1">
<para>Specify your image registry:</para>
<itemizedlist>
<listitem>
<simpara>For an internal OpenShift&#160;Kubernetes&#160;Engine registry, specify the internal registry route, for example, <literal>image-registry.openshift-image-registry.svc:5000/openshift/vddk:&lt;tag&gt;</literal>.</simpara>
</listitem>
<listitem>
<simpara>For an external registry, specify the server name, path, and tag, for example, <literal>server.example.com:5000/vddk:&lt;tag&gt;</literal>.</simpara>
</listitem>
</itemizedlist>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>Push the image to the registry:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ podman push &lt;registry_route_or_server_path&gt;/vddk:&lt;tag&gt;</programlisting>
</listitem>
<listitem>
<simpara>Edit the <literal>v2v-vmware</literal> ConfigMap in the <emphasis role="strong">openshift-cnv</emphasis> project:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc edit configmap v2v-vmware -n openshift-cnv</programlisting>
</listitem>
<listitem>
<simpara>Add the <literal>vddk-init-image</literal> parameter to the <literal>data</literal> stanza:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">...
data:
  vddk-init-image: &lt;registry_route_or_server_path&gt;/vddk:&lt;tag&gt;</programlisting>
</listitem>
</orderedlist>
</section>
</chapter>
<chapter xml:id="migrating-virtual-machines_mtv">
<title>Migrating virtual machines</title>
<section xml:id="migrating-vms-web-console_mtv">
<title>Migrating virtual machines with the web console</title>
<simpara>You can add providers, create network and storage mappings, and create and run a migration plan in the web console.</simpara>
<section xml:id="adding-providers_migrating-vms-web-console">
<title>Adding providers</title>
<simpara>You must add the KubeVirt and VMware providers in the web console.</simpara>
<section xml:id="adding-virt-provider_migrating-vms-web-console">
<title>Adding the KubeVirt provider</title>
<simpara>You can add the KubeVirt provider in the {mtv-short} web console.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara><link xlink:href="https://docs.openshift.com/container-platform/4.6/authentication/using-service-accounts-in-applications.html"><literal>VirtController</literal> service account token</link></simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the web console, navigate to <emphasis role="strong">Providers</emphasis> and click <emphasis role="strong">Add provider</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">KubeVirt</emphasis> from the <emphasis role="strong">Type</emphasis> list.</simpara>
</listitem>
<listitem>
<simpara>Fill in the following fields:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Cluster name</emphasis>: OpenShift cluster name to display in the list of providers</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">URL</emphasis>: OpenShift cluster API endpoint</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Service account token</emphasis>: VirtController service account token</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Check connection</emphasis> to verify the credentials.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add</emphasis> to add and save the provider.</simpara>
<simpara>The provider appears in the list of providers.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="adding-vmware-provider_migrating-vms-web-console">
<title>Adding the VMware provider</title>
<simpara>You can add the VMware provider in the {mtv-short} web console.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>Admin privileges</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the web console, navigate to <emphasis role="strong">Providers</emphasis> and click <emphasis role="strong">Add provider</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">VMware</emphasis> from the <emphasis role="strong">Type</emphasis> list.</simpara>
</listitem>
<listitem>
<simpara>Fill in the following fields:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Name</emphasis>: vCenter name to display in the list of providers</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Hostname</emphasis>: vCenter host name or IP address</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Username</emphasis>: vCenter admin user name, for example, <literal>administrator@vsphere.local</literal></simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Password</emphasis>: vCenter password</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Check connection</emphasis> to verify the credentials.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add</emphasis> to add and save the provider.</simpara>
<simpara>The provider appears in the list of providers.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="creating-mappings_migrating-vms-web-console">
<title>Creating mappings</title>
<simpara>You must create mappings to map the source and target networks and storage.</simpara>
<section xml:id="creating-network-mapping_migrating-vms-web-console">
<title>Creating a network mapping</title>
<simpara>You can create a network mapping to map VMware networks to KubeVirt networks.</simpara>
<note>
<simpara>You cannot map an opaque network to a KubeVirt network.</simpara>
</note>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the web console, navigate to <emphasis role="strong">Mappings</emphasis> &#8594; <emphasis role="strong">Network</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Create mapping</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select a <emphasis role="strong">Source provider</emphasis> and a <emphasis role="strong">Target provider</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select a network from the <emphasis role="strong">Source networks</emphasis> list and from the <emphasis role="strong">Target networks</emphasis> list.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add</emphasis> to create additional network mappings or to map multiple source networks to a single target network.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Create</emphasis>.</simpara>
<simpara>The mapping is displayed in the <emphasis role="strong">Network mappings</emphasis> list.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="creating-storage-mapping_migrating-vms-web-console">
<title>Creating a storage mapping</title>
<simpara>You can create a storage mapping to map VMware data stores to KubeVirt storage classes.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>The local and shared persistent storage must support VM migration.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the web console, navigate to <emphasis role="strong">Mappings</emphasis> &#8594; <emphasis role="strong">Storage</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Create mapping</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select a <emphasis role="strong">Source provider</emphasis> and a <emphasis role="strong">Target provider</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select a data store from the <emphasis role="strong">Source datastores</emphasis> list and a storage class from the <emphasis role="strong">Target storage classes</emphasis> list.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add</emphasis> to create additional storage mappings or to map multiple data stores to a single storage class.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Create</emphasis>.</simpara>
<simpara>The mapping is displayed in the <emphasis role="strong">Storage mappings</emphasis> list.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="creating-a-migration-plan_migrating-vms-web-console">
<title>Creating a migration plan</title>
<simpara>You can create a migration plan in the web console.</simpara>
<simpara>A migration plan allows you to group virtual machines that should be migrated together or with the same migration parameters, for example, a percentage of the members of a cluster or a complete application.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>The migration network supports migration.</simpara>
</listitem>
<listitem>
<simpara>The web console has source and target providers.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the web console, navigate to <emphasis role="strong">Migration plans</emphasis> and click <emphasis role="strong">Create migration plan</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Fill in the following fields in the <emphasis role="strong">General settings</emphasis> screen:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Plan name</emphasis>: Plan name that is displayed in the web console.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Plan description</emphasis>: Optional. Brief description of the migration plan.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Source provider</emphasis>: Select a VMware provider.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Target provider</emphasis>: Select the KubeVirt provider.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Filter the VMs that you want to migrate by selecting data centers, clusters, or folders.</simpara>
</listitem>
<listitem>
<simpara>Select the VMs to migrate. You can click each VM to view its migration risk assessment.</simpara>
</listitem>
<listitem>
<simpara>Select an existing storage mapping or create a new storage mapping.</simpara>
</listitem>
<listitem>
<simpara>If you want to create a new storage mapping:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Select a data store from the <emphasis role="strong">Source datastores</emphasis> list and a storage class from the <emphasis role="strong">Target storage classes</emphasis> list.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add</emphasis> to create additional storage mappings or to map multiple data stores to a single storage class.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select an existing network mapping or create a new network mapping.</simpara>
</listitem>
<listitem>
<simpara>If you want to create a new network mapping:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Select a network from the <emphasis role="strong">Source networks</emphasis> list and a network from the <emphasis role="strong">Target networks</emphasis> list.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add</emphasis> to create additional network mappings or to map multiple source networks to a single target network.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Review your migration plan and click <emphasis role="strong">Finish</emphasis>.</simpara>
<simpara>The migration plan is saved in the migration plan list.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="running-migration-plan_migrating-vms-web-console">
<title>Running a migration plan</title>
<simpara>You can run a migration plan and view its progress in the web console.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>The VMware VMs must be powered off.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the web console, navigate to <emphasis role="strong">Migration plans</emphasis>.</simpara>
<simpara>The <emphasis role="strong">Migration plans</emphasis> list displays the source and target providers, the number of VMs being migrated, the status of the plan, and a high-level progress bar that shows how many VMs have been migrated.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Start</emphasis> beside a migration plan with a <emphasis role="strong">Ready</emphasis> status to run the plan.</simpara>
</listitem>
<listitem>
<simpara>To view the <emphasis role="strong">Migration Details by VM</emphasis> screen, click the name of a migration plan.</simpara>
<simpara>This screen displays the migration start and end time, the amount of data copied, and a progress pipeline for each VM being migrated.</simpara>
</listitem>
<listitem>
<simpara>Expand a VM to view the migration steps, elapsed time of each step, and the state.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="migrating-virtual-machines-cli_mtv">
<title>Migrating virtual machines from the CLI</title>
<simpara>You can migrate virtual machines from the command line (CLI) by creating the following custom resources:</simpara>
<itemizedlist>
<listitem>
<simpara>Secret: Contains the VMware vSphere credentials</simpara>
</listitem>
<listitem>
<simpara>Provider: Specifies the VMware provider</simpara>
</listitem>
<listitem>
<simpara>Plan: Specifies the source and target clusters, network mappings, data store mappings, and VMs to migrate</simpara>
</listitem>
<listitem>
<simpara>Migration: Runs the Plan</simpara>
<simpara>If a Migration does not complete, you can create a new Migration CR, referencing the same Plan, to migrate the remaining VMs.</simpara>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara><link xlink:href="https://docs.openshift.com/container-platform/4.6/cli_reference/openshift_cli/getting-started-cli.html">OpenShift CLI</link> installed</simpara>
</listitem>
<listitem>
<simpara>Admin privileges</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Get the SSL thumbprint of the vCenter:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ openssl s_client \
    -connect &lt;vcenter.example.com&gt;:443 \ <co xml:id="CO2-1"/>
    &lt; /dev/null 2&gt;/dev/null \
    | openssl x509 -fingerprint -noout -in /dev/stdin \
    | cut -d '=' -f 2</programlisting>
<calloutlist>
<callout arearefs="CO2-1">
<para>Specify the vCenter host name.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>Create a Secret object with the VMware credentials:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ cat &lt; EOF | oc apply -f -
---
apiVersion: v1
kind: Secret
metadata:
  name: vmware-secret
  namespace: openshift-migration
type: Opaque
stringData:
  user: administrator@vsphere.local
  password: &lt;password&gt; <co xml:id="CO3-1"/>
  thumbprint: &lt;01:23:45:67:89:AB:CD:EF:01:23:45:67:89:AB:CD:EF:01:23:45:67&gt; <co xml:id="CO3-2"/>
EOF</programlisting>
<calloutlist>
<callout arearefs="CO3-1">
<para>Specify the password.</para>
</callout>
<callout arearefs="CO3-2">
<para>Specify the thumbprint.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>Create a Provider object for VMware vSphere:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ cat &lt; EOF | oc apply -f -
---
apiVersion: virt.konveyor.io/v1alpha1
kind: Provider
metadata:
  name: vmware-provider
  namespace: openshift-migration
spec:
  type: vsphere
  url: https://&lt;vcenter.example.com&gt;/sdk <co xml:id="CO4-1"/>
  secret:
    name: vmware-secret <co xml:id="CO4-2"/>
    namespace: openshift-migration
EOF</programlisting>
<calloutlist>
<callout arearefs="CO4-1">
<para>Specify the vSphere API end point.</para>
</callout>
<callout arearefs="CO4-2">
<para>Specify the Secret.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>Create a Plan object for the migration:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ cat &lt; EOF | oc apply -f -
---
apiVersion: virt.konveyor.io/v1alpha1
kind: Plan
metadata:
  name: test-migration-plan
  namespace: openshift-migration
spec:
  provider:
    source:
      name: vmware-provider
      namespace: openshift-migration
    destination:
      name: host <co xml:id="CO5-1"/>
      namespace: openshift-migration
  map:
    networks:
      - source:
          id: &lt;network-31&gt; <co xml:id="CO5-2"/>
        destination:
          type: pod
          name: pod
          namespace: openshift-migration
      - source:
          id: &lt;network-723&gt;
        destination:
          type: pod
          name: pod
          namespace: openshift-migration
    datastores:
      - source:
          id: &lt;datastore-30&gt; <co xml:id="CO5-3"/>
        destination:
          storageClass: standard
      - source:
          id: &lt;datastore-35&gt;
        destination:
          storageClass: standard
  vms:
    - id: &lt;vm-1630&gt; <co xml:id="CO5-4"/>
    - id: &lt;vm-2841&gt;
EOF</programlisting>
<calloutlist>
<callout arearefs="CO5-1">
<para>The OpenShift provider is added automatically as <literal>host</literal> when the Operator is deployed.</para>
</callout>
<callout arearefs="CO5-2">
<para>Specify a source network.</para>
</callout>
<callout arearefs="CO5-3">
<para>Specify a source data store.</para>
</callout>
<callout arearefs="CO5-4">
<para>Specify the IDs of the VMs to migrate.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>Create a Migration CR to run the Plan CR:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ cat &lt; EOF | oc apply -f -
---
apiVersion: virt.konveyor.io/v1alpha1
kind: Migration
metadata:
  name: migration-test-001
  namespace: openshift-migration
spec:
  plan:
    name: test-migration-plan
    namespace: openshift-migration
EOF</programlisting>
</listitem>
</orderedlist>
<simpara>The Migration CR creates a <literal>VirtualMachineImport</literal> object for each VM being migrated. You can monitor the progress of the migration by viewing the <literal>VirtualMachineImport</literal> pods in the <literal>openshift-migration</literal> namespace.</simpara>
</section>
</chapter>
<chapter xml:id="using-migration-analytics_mtv">
<title>Using Migration Analytics</title>
<simpara>You can use the Migration Analytics service at <link xlink:href="https://cloud.redhat.com">cloud.redhat.com</link> to analyze your VMware workloads and to provide migration recommendations.</simpara>
<simpara>Migration Analytics generates a report that you can view in your browser or download as a CSV file.</simpara>
<section xml:id="about-migration-analytics-report_using-migration-analytics">
<title>About the Migration Analytics report</title>
<simpara>The Migration Analytics report contains a VM migration summary and a VM migration inventory.</simpara>
<formalpara>
<title>VM migration summary</title>
<para>The VM migration summary displays the following information:</para>
</formalpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Summary</emphasis>: Providers, hosts, clusters, and VMs. Percentage of VMs that have no issues for migrating to KubeVirt.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Migration risk assessment</emphasis>: Suitability of a VM for migration. The assessment is determined by rules that detect certain configurations or operating systems.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Rules summary (issues that impact migration risk)</emphasis>: Information about the rules.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Operating systems identified</emphasis>: Operating systems that can be migrated to Red Hat Enterprise Linux.</simpara>
</listitem>
</itemizedlist>
<formalpara>
<title>VM migration inventory</title>
<para>The VM migration inventory displays a list of virtual machines with detailed information.</para>
</formalpara>
<simpara>You can click a VM to view its migration risk assessment.</simpara>
<simpara>You can filter the VM migration inventory and export it as a CSV file.</simpara>
</section>
<section xml:id="creating-migration-analytics-report_using-migration-analytics">
<title>Creating a Migration Analytics report</title>
<simpara>You can download VMware provider data in the Forklift web console and upload it to the Migration Analytics service on <link xlink:href="https://cloud.redhat.com/migrations/migration-analytics">cloud.redhat.com</link> to create a Migration Analytics report.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the web console, navigate to <emphasis role="strong">Providers</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">VMware</emphasis> tab, select a VMware provider and click <emphasis role="strong">Download data</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Launch a browser and navigate to <link xlink:href="https://cloud.redhat.com">cloud.redhat.com</link>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Migration Services</emphasis> tile, click <emphasis role="strong">Migration Analytics</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Get Started</emphasis> if you are creating a report for the first time or navigate to <emphasis role="strong">Payload Files</emphasis> and click <emphasis role="strong">Upload file</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Browse to the VMware provider data file and click <emphasis role="strong">Open</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the data file and click <emphasis role="strong">Create report</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">OpenShift Virtualization</emphasis> as the <emphasis role="strong">Preferred target</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">Report name</emphasis> and optional <emphasis role="strong">Report description</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">OK</emphasis>.</simpara>
<simpara>The generated report appears in the <emphasis role="strong">Reports</emphasis> list.</simpara>
</listitem>
</orderedlist>
<bridgehead xml:id="Filtering-migration-analytics-report_using-migration-analytics" renderas="sect2">Filtering a Migration Analytics report</bridgehead>
<simpara>You can filter the results of a Migration Analytics report to display virtual machines according to provider, cluster, migration effort, and other parameters.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <emphasis role="strong">VM migration inventory</emphasis> in the Migration Analytics report.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Filter</emphasis> and select a filter type, for example, <emphasis role="strong">Provider</emphasis>, <emphasis role="strong">OS type</emphasis>, or <emphasis role="strong">Rules</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Filter by &lt;filter_type&gt;</emphasis> and select one or more options.</simpara>
</listitem>
<listitem>
<simpara>If you are filtering by <emphasis role="strong">VM name</emphasis>, enter the text in the search field.</simpara>
<simpara>The filtered virtual machines are displayed.</simpara>
</listitem>
</orderedlist>
<bridgehead xml:id="Exporting-migration-analytics-report_using-migration-analytics" renderas="sect2">Exporting a Migration Analytics report</bridgehead>
<simpara>You can export a complete or filtered Migration Analytics report in CSV format.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <emphasis role="strong">VM migration inventory</emphasis> in the Migration Analytics report.</simpara>
</listitem>
<listitem>
<simpara>Optional: Filter the report.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Export as CSV</emphasis>.</simpara>
<simpara>The Migration Analytics report is downloaded to your local machine as a CSV file.</simpara>
</listitem>
</orderedlist>
</section>
</chapter>
<chapter xml:id="troubleshooting_mtv">
<title>Troubleshooting</title>
<section xml:id="collecting-logs_troubleshooting">
<title>Collecting logs - to do</title>
<simpara>TBD</simpara>
</section>
<section xml:id="known-issues_troubleshooting">
<title>Known issues - in progress</title>
<simpara>This section describes known issues and steps to resolve them.</simpara>
<section xml:id="_unsupported_vmware_features">
<title>Unsupported VMware features</title>
<simpara>The following VMware features are not supported by KubeVirt:</simpara>
<itemizedlist>
<listitem>
<simpara>VMware Site Recovery Manager (SRM). You can migrate the VM but SRM will not be enabled.</simpara>
</listitem>
<listitem>
<simpara>vSphere Distributed Power Management (DPM). You can migrate the VM but DPM will not be enabled.</simpara>
</listitem>
<listitem>
<simpara>VMDK with SCSI-3 persistent reservation (PR). You can migrate the VM but SCSI-3 PR will not be enabled. NEED INFO</simpara>
</listitem>
</itemizedlist>
</section>
</section>
</chapter>
</book>
